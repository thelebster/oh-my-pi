proxy_cache_path /tmp/hls-cache levels=1:2 keys_zone=hls:10m max_size=512m inactive=30s;

server {
    listen 80;
    server_name _;

    location /stream/ {
        proxy_pass http://127.0.0.1:8888/stream/;
        proxy_cache hls;
        proxy_cache_valid 200 5s;
        proxy_cache_use_stale error timeout updating;
        proxy_cache_lock on;

        # Allow browser playback
        add_header Access-Control-Allow-Origin *;
        add_header Cache-Control "public, max-age=2";
    }
}
